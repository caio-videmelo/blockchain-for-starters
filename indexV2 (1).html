<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Application</title>
    <link rel="stylesheet" href="stylesV4.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // JavaScript for blockchain functionality
        const CryptoJS = require('crypto-js');

        class Transaction {
            constructor(sender, receiver, amount) {
                this.sender = sender;
                this.receiver = receiver;
                this.amount = amount;
            }

            toString() {
                return JSON.stringify(this);
            }
        }

        class Block {
            constructor(index, timestamp, transactions, previousHash = '') {
                this.index = index;
                this.timestamp = timestamp;
                this.transactions = transactions;
                this.previousHash = previousHash;
                this.hash = this.calculateHash();
            }

            calculateHash() {
                return CryptoJS.SHA256(this.index + this.timestamp + JSON.stringify(this.transactions) + this.previousHash).toString();
            }
        }

        class Blockchain {
            constructor() {
                this.chain = [this.createGenesisBlock()];
                this.pendingTransactions = [];
                this.miningReward = 100; // Reward for mining a new block (in a real scenario, this would be dynamic)
            }

            createGenesisBlock() {
                return new Block(0, new Date().toISOString(), [], "0");
            }

            getLatestBlock() {
                return this.chain[this.chain.length - 1];
            }

            minePendingTransactions(miningRewardAddress) {
                const newBlock = new Block(
                    this.chain.length,
                    new Date().toISOString(),
                    this.pendingTransactions,
                    this.getLatestBlock().hash
                );
                this.chain.push(newBlock);

                console.log("Block successfully mined!");
                console.log("Hash: " + newBlock.hash);
                
                // Reward for mining
                this.pendingTransactions = [
                    new Transaction(null, miningRewardAddress, this.miningReward)
                ];
            }

            createTransaction(transaction) {
                this.pendingTransactions.push(transaction);
            }

            getBalanceOfAddress(address) {
                let balance = 0;

                for (const block of this.chain) {
                    for (const trans of block.transactions) {
                        if (trans.sender === address) {
                            balance -= trans.amount;
                        }
                        if (trans.receiver === address) {
                            balance += trans.amount;
                        }
                    }
                }

                return balance;
            }
        }

        const myBlockchain = new Blockchain();

        function generateBlock() {
            const formData = new FormData(document.getElementById('formID'));
            const data = formData.get('data');
            const prev = myBlockchain.chain.length > 0 ? myBlockchain.chain[myBlockchain.chain.length - 1].hash : "000000000";
            const hash = CryptoJS.SHA256(data);
            const newBlock = new Block(myBlockchain.chain.length, new Date().toISOString(), hash, prev);

            myBlockchain.chain.push(newBlock);

            const blockchainDisplay = document.getElementById('blockchainDisplay');
            const blockElement = document.createElement('div');
            blockElement.classList.add('block');
            blockElement.innerHTML = `
                <h3>Block #${newBlock.index}</h3>
                <p><strong>Data:</strong> ${data}</p>
                <p><strong>Previous Hash:</strong> ${newBlock.previousHash}</p>
                <p><strong>Hash:</strong> <span class="hash">${newBlock.hash}</span></p>
            `;
            blockchainDisplay.appendChild(blockElement);
        }
    </script>
</head>
<body>
    <h1>Simple Blockchain</h1>

    <form id="formID">
        <textarea name="data" placeholder="Data" rows="10" cols="20"></textarea><br/>
        <input type="button" value="Generate Block" onclick="generateBlock()"/>
    </form>

    <h3>Blocks</h3>

    <div id="blockchainDisplay"></div>
</body>
</html>
